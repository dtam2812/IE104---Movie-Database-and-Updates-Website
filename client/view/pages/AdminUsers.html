<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title data-i18n="admin.users.title">Admin Users Management</title>
    <link
      rel="icon"
      type="image/png"
      href="../../../public/assets/image/logo-web-black.png"
    />
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../../Services/reset.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <link rel="stylesheet" href="../../Style/HeaderAndFooter.css" />
    <link rel="stylesheet" href="../../Style/AdminPage.css" />
  </head>

  <body>
    <!-- start-header -->
    <div id="header"></div>

    <script type="module">
      import { headerjs } from "../../js/Header.js";
      import { searchBar } from "../../js/SearchBar.js";
      import { initTranslate } from "../../js/Translate.js";
      import { AdminUsers_js } from "../../js/AdminUsers.js";

      // Load header & search bar
      fetch("../components/Header.html")
        .then((res) => res.text())
        .then((html) => {
          document.getElementById("header").innerHTML = html;
          headerjs();
          return fetch("../components/SearchBar.html");
        })
        .then((res) => res.text())
        .then((searchHTML) => {
          document.querySelector(".search-box").innerHTML = searchHTML;
          searchBar();
          // Initialize translation after DOM is ready
          return initTranslate();
        })
        .then(() => {
          // Initialize AdminUsers after translation
          AdminUsers_js();
        })
        .catch((error) => console.error("Initialization failed:", error));
    </script>

    <!-- end-header -->

    <!-- Main Section -->
    <section class="main">
      <!-- Sidebar -->
      <div class="admin-menu-container">
        <nav class="admin-menu">
          <ul class="admin-menu-list">
            <li>
              <a class="active" href="#">
                <i class="fa-solid fa-user"></i>
                <span data-i18n="admin.users">Users</span>
              </a>
            </li>
            <li>
              <a href="../pages/AdminMovies.html">
                <i class="fa-solid fa-film"></i>
                <span data-i18n="admin.movies">Movies</span>
              </a>
            </li>
            <li>
              <a href="../pages/AdminTVShows.html">
                <i class="fa-solid fa-tv"></i>
                <span data-i18n="admin.tvshows">TV Shows</span>
              </a>
            </li>
            <li>
              <a href="../pages/HomePage.html">
                <i class="fa-solid fa-right-from-bracket"></i>
                <span data-i18n="admin.signout">Sign Out</span>
              </a>
            </li>
          </ul>
        </nav>
      </div>

      <!-- Main Content -->
      <div class="admin-main-container">
        <div class="admin-main-content">
          <div class="am-content-heading">
            <h1 data-i18n="admin.users.heading">Users</h1>
            <a class="add-btn">
              <i class="fa-solid fa-plus"></i>
              <span data-i18n="admin.addUser">Add User</span>
            </a>
          </div>

          <!-- Search and Filter -->
          <div class="am-search-box">
            <div class="search-bar">
              <div class="search-icon">
                <i class="fa-solid fa-magnifying-glass"></i>
              </div>
              <input
                class="search-input"
                data-i18n-placeholder="admin.users.search"
                placeholder="Search by user name, email or ID (e.g. UIT001)"
                autocomplete="off"
              />
            </div>
            <div class="filter-bar">
              <select class="filter-select">
                <option value="all" data-i18n="admin.users.allRoles">All Roles</option>
                <option value="Admin" data-i18n="admin.users.role.admin">Admin</option>
                <option value="User" data-i18n="admin.users.role.user">User</option>
              </select>
              <select class="filter-select">
                <option value="all" data-i18n="admin.users.allStatus">All Status</option>
                <option value="active" data-i18n="admin.users.status.active">Active</option>
                <option value="banned" data-i18n="admin.users.status.banned">Banned</option>
              </select>
            </div>
          </div>

          <!-- Table -->
          <div class="dm-table-container">
            <div class="dm-table-heading">
              <h2>
                <span data-i18n="admin.users.count">Users</span> (0)
              </h2>
            </div>
            <table class="dm-table">
              <thead>
                <tr>
                  <th data-i18n="admin.users.table.no">No.</th>
                  <th data-i18n="admin.users.table.user">User</th>
                  <th data-i18n="admin.users.table.role">Role</th>
                  <th data-i18n="admin.users.table.status">Status</th>
                  <th data-i18n="admin.users.table.created">Created</th>
                  <th data-i18n="admin.users.table.edit">Edit</th>
                  <th data-i18n="admin.users.table.detail">Detail</th>
                  <th></th>
                </tr>
              </thead>
              <tbody class="dm-table-body"></tbody>
            </table>
          </div>

          <!-- Pagination -->
          <div class="content__pagination">
            <button class="pagination-left-arrow disable">
              <i class="fa-solid fa-arrow-left"></i>
            </button>
            <div class="pagination__main">
              <span class="pagination-page-current">1</span>
              <span>/ 10</span>
            </div>
            <button class="pagination-right-arrow">
              <i class="fa-solid fa-arrow-right"></i>
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Modal: Add/Edit User -->
    <div class="modal-user hidden">
      <div class="modal_backdrop"></div>
      <div class="modal_container">
        <div class="modal_dialog modal_dialog_centered">
          <div class="modal_content">
            <button class="btn modal_close" aria-label="close">
              <i class="fa-solid fa-xmark"></i>
            </button>
            <div class="form-wrapper user-form">
              <div class="content_header mb2">
                <h1 class="modal-title" data-i18n="admin.users.modal.add">Add User</h1>
              </div>

              <div class="content_body">
                <!-- Avatar Preview -->
                <div class="user-avatar mb3 mt3">
                  <img
                    src="../../public/assets/image/user_avatar_default.jpg"
                    alt="User Avatar"
                  />
                  <div class="upload-img">
                    <label 
                      class="avatar-label" 
                      for="avatar-input"
                      data-i18n="admin.users.modal.uploadImage"
                    >Upload image</label>
                    <input
                      type="file"
                      class="avatar-input"
                      id="avatar-input"
                      accept="image/*"
                    />
                  </div>
                </div>

                <form class="v-form">
                  <!-- Hidden ID field -->
                  <input type="hidden" name="id" />

                  <!-- ID Display (readonly, shown only in Edit mode) -->
                  <div
                    class="form-group mb1 user-id-display"
                    style="display: none"
                  >
                    <label>
                      <span data-i18n="admin.users.modal.userId">User ID:</span>
                    </label>
                    <input
                      class="form-control"
                      type="text"
                      name="id-display"
                      data-i18n-placeholder="admin.users.modal.autoGenerated"
                      placeholder="Auto-generated"
                      readonly
                    />
                  </div>

                  <!-- Name -->
                  <div class="form-group mb1">
                    <label>
                      <span data-i18n="admin.users.modal.userName">User Name:</span>
                      <span style="color: red" data-i18n="admin.required">*</span>
                    </label>
                    <input
                      class="form-control"
                      type="text"
                      name="name"
                      data-i18n-placeholder="admin.users.modal.userName"
                      placeholder="User name"
                      required
                    />
                  </div>

                  <!-- Email -->
                  <div class="form-group mb1">
                    <label>
                      <span data-i18n="admin.users.modal.email">Email:</span>
                      <span style="color: red" data-i18n="admin.required">*</span>
                    </label>
                    <input
                      class="form-control"
                      type="email"
                      name="email"
                      placeholder="Email"
                      required
                    />
                  </div>

                  <!-- Role -->
                  <div class="form-group mb1">
                    <label>
                      <span data-i18n="admin.users.modal.role">Role:</span>
                      <span style="color: red" data-i18n="admin.required">*</span>
                    </label>
                    <select class="form-control" name="role" required>
                      <option 
                        value="" 
                        disabled 
                        selected 
                        data-i18n="admin.users.modal.selectRole"
                      >Select role</option>
                      <option value="Admin" data-i18n="admin.users.role.admin">Admin</option>
                      <option value="User" data-i18n="admin.users.role.user">User</option>
                    </select>
                  </div>

                  <!-- Password (only shown when adding) -->
                  <div class="form-group mb1 password-group">
                    <label>
                      <span data-i18n="admin.users.modal.password">Password:</span>
                      <span style="color: red" data-i18n="admin.required">*</span>
                    </label>
                    <input
                      class="form-control"
                      type="password"
                      name="password"
                      minlength="6"
                      data-i18n-placeholder="admin.users.modal.password"
                      placeholder="Password"
                      required
                    />
                  </div>

                  <!-- Confirm Password (only shown when adding) -->
                  <div class="form-group mb1 cf-password-group">
                    <label>
                      <span data-i18n="admin.users.modal.confirmPassword">Confirm Password:</span>
                      <span style="color: red" data-i18n="admin.required">*</span>
                    </label>
                    <input
                      class="form-control"
                      type="password"
                      name="cf_password"
                      minlength="6"
                      data-i18n-placeholder="admin.users.modal.confirmPassword"
                      placeholder="Confirm password"
                      required
                    />
                    <small 
                      class="non-same-pw" 
                      style="display: none; color: red"
                      data-i18n="admin.users.modal.passwordMismatch"
                    >Passwords do not match.</small>
                  </div>

                  <!-- Submit Button -->
                  <div class="form-group action-btn-center mt3 mb3">
                    <button 
                      type="submit" 
                      class="btn btn-primary"
                      data-i18n="admin.users.modal.create"
                    >Create</button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- start-footer -->
    <div id="footer"></div>

    <script type="module">
      fetch("../components/Footer.html")
        .then((res) => res.text())
        .then((html) => {
          document.getElementById("footer").innerHTML = html;
        })
        .catch((error) => {
          console.error("Fetch footer failed:", error);
        });
    </script>
    <!-- end-footer -->
  </body>
</html>